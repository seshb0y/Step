# Тема урока: Введение в ASP.NET 
* Как работает Web Server ? 
* Как работает протокол HTTP ?
* Что такое Middleware ?
* Внедрение IOC в наше приложение 


## Как работает Web Server ?

`Web Server` - это программа, которая принимает запросы от клиентов и отправляет им ответы. Вы можете расценивать это как бесконечный цикл, который принимает запросы и отправляет ответы. Пока вы не сделаете 

```csharp
HttpContext.Response.Close();
```

ваш бразуер будет ждать ответа от сервера. 

Предположим у вас есть свой `Web Api`, который работает с фильмаи. Назовем его `MovieApi`. Как только вы отправите запрос на `http://localhost:5000/api/movies` ваш `Web Server` принимает этот запрос. Предположим что мы должны вернуть `json` в наш браузер. 

```csharp

while(true) // тут мы принимаем запросы
{

    if(HttpContext.Request.Path == "/api/movies")
    {
        var movies = new List<Movie>
        {
            new Movie { Name = "The Matrix", Year = 1999 },
            new Movie { Name = "The Matrix Reloaded", Year = 2003 },
            new Movie { Name = "The Matrix Revolutions", Year = 2003 }
        };

        var json = JsonConvert.SerializeObject(movies);

        HttpContext.Response.ContentType = "application/json";

        HttpContext.Response.Write(json);

        HttpContext.Response.Close();

    }
}

```

## Как работает протокол HTTP ?

`HTTP` - Hyper Text Transfer Protocol, это протокол уровня `Application`, модели `OSI`. Он используется для передачи данных между клиентом и сервером. В HTTP есть несколько версий, но наиболее популярные это `HTTP/1.1` и `HTTP/2`. Разница между ними в том, что `HTTP/2` поддерживает множество запросов на одном соединении, а `HTTP/1.1` каждый запрос требует нового соединения. 

По умолчанию `Kestrel` - ядро(веб-сервер) нашего ASP.NET при использовании `HTTPS` использует `HTTP/2`, если же мы используем `HTTP` то он использует `HTTP/1.1`.

Под капотом `HTTP` это просто текстовый протокол, который состоит из `заголовков` и `тела`. 

## Различия между HTTP/2 и HTTP/1.1, влияющие на производительность

### Мультиплексирование
- **HTTP/1.1**: Загружает ресурсы один за другим. Если один из ресурсов не может быть загружен, это блокирует загрузку всех остальных ресурсов.
- **HTTP/2**: Использует единое TCP-соединение для отправки нескольких потоков данных одновременно, благодаря чему ни один ресурс не блокирует другие. Это достигается за счет разделения данных на сообщения в двоичном формате и их нумерации, чтобы клиент мог идентифицировать, к какому потоку относится каждое сообщение.

---

### Server Push
- **HTTP/1.1**: Сервер отдает содержимое только после того, как клиент отправит соответствующий запрос. Однако это не всегда удобно для современных веб-страниц, которые часто содержат десятки отдельных ресурсов.
- **HTTP/2**: Позволяет серверу "продвигать" содержимое клиенту до того, как оно будет запрошено. Сервер также отправляет сообщение с перечнем того, какие ресурсы он собирается передать, чтобы клиент был к этому готов. Это похоже на то, как если бы Боб сначала отправил Алисе оглавление своего романа, а затем весь текст.

---

### Сжатие заголовков
- **HTTP/1.1**: Для ускорения загрузки использует базовое сжатие HTTP-сообщений, чтобы сделать их меньше по размеру.
- **HTTP/2**: Применяет более продвинутый метод сжатия под названием HPACK, который устраняет дублирующуюся информацию в HTTP-заголовках. Это сокращает размер каждого HTTP-пакета на несколько байтов. Учитывая количество пакетов, необходимое для загрузки даже одной страницы, эти сокращения существенно ускоряют процесс загрузки.

---

## Что такое Middleware ?

Ваш веб-сервер должен пропускать вас через цепочку событий, для того чтобы обработать ваш запрос. 
